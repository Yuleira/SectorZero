# 地球新主 - 产品需求文档 (PRD)

**文档版本**: v1.0
**创建日期**: 2025-12-23
**产品名称**: 地球新主 (New Earth Master)
**产品类型**: LBS末日生存手游
**目标平台**: iOS (App Store全球175个国家/地区)

---

## 一、产品概述

### 1.1 产品定位
"地球新主"是一款基于LBS（位置服务）的末日生存手游，融合了真实地理位置与虚拟生存体验。玩家通过在现实世界中行走来"圈占"虚拟领地，探索真实地标获取资源，建造设施，并与其他玩家进行交易与社交互动。

### 1.2 核心价值主张
- **Walk to Earn**: 走路即可获得游戏收益
- **真实与虚拟融合**: 基于真实GPS和POI数据的游戏体验
- **希望朋克美学**: 废土之上的新生，绝望中的希望
- **全球化市场**: 支持多语言，面向全球玩家

### 1.3 目标用户
| 用户画像 | 特征描述 |
|---------|---------|
| 核心用户 | 18-35岁，喜欢户外活动，对生存类游戏感兴趣 |
| 拓展用户 | 运动爱好者，希望通过游戏激励自己多走路 |
| 潜在用户 | 宝可梦GO玩家，寻找新的LBS游戏体验 |

### 1.4 产品愿景
打造全球领先的LBS生存游戏，让玩家用双脚丈量世界，在虚拟废土上重建文明。

---

## 二、产品背景

### 2.1 世界观设定
- **2048年**: "终末战争"爆发，全球文明在72小时内崩塌，99%人口消失
- **2051年**: 幸存者从废墟中走出，《新开拓者协议》颁布
- **核心法则**: "凡以双足丈量之无主土地，皆为开拓者所有"

### 2.2 视觉风格
**"希望朋克"** - 废土之上的新生：
- 破败的建筑与新生的植物共存
- 末日风格的卫星地图
- 绿色作为希望的象征色

---

## 三、核心业务流程

### 3.1 游戏核心循环
```
登录注册 → 圈地占领 → 探索搜刮 → 获得资源
    ↑                              ↓
    │         ┌─────────────────────────┐
    │         │  资源用途：              │
    │         │  • 建造建筑（消耗资源）   │
    │         │  • 交易换物（流通资源）   │
    │         │  • 生存消耗（食物/水）    │
    │         └─────────────────────────┘
    │                              ↓
    └──────── 通讯社交 ← 成就排行 ← 发展壮大
```

### 3.2 关键路径
1. 用户注册/登录 → 获得开拓者身份
2. GPS圈地 → 拥有第一块领地
3. 探索POI → 获取生存资源
4. 建造设施 → 扩展功能
5. 社交交易 → 互通有无
6. 持续活跃 → 成就与排名

---

## 四、功能需求清单

### 4.1 第一部分：登录与圈地系统

#### P0-001 登录注册系统
| 属性 | 说明 |
|------|------|
| 优先级 | P0（核心功能） |
| 功能描述 | 支持多种登录方式的用户身份认证系统 |
| 核心文件 | AuthManager.swift |

**功能要求**:
- [ ] 邮箱注册登录（用户名+密码）
- [ ] Apple ID一键登录（Sign in with Apple）
- [ ] Google账号登录
- [ ] 邮箱验证
- [ ] 密码重置
- [ ] 会话管理（多设备登录）

**技术方案**: Supabase Auth

---

#### P0-002 GPS圈地系统
| 属性 | 说明 |
|------|------|
| 优先级 | P0（核心功能） |
| 功能描述 | 玩家通过真实行走在地图上绘制多边形领地 |
| 核心文件 | LocationManager.swift |

**功能要求**:
- [ ] 实时GPS定位与轨迹绘制
- [ ] 蓝色轨迹线显示当前路径
- [ ] 闭合检测（回到起点附近自动闭合）
- [ ] 多边形合法性验证（无自交叉）
- [ ] 领地重叠检测
- [ ] 面积计算与显示

**验证规则**:
- 必须闭合成完整多边形
- 不能与他人领地重叠
- 不能自交叉

**技术方案**: 苹果MapKit + CoreLocation

---

#### P0-003 领地管理
| 属性 | 说明 |
|------|------|
| 优先级 | P0（核心功能） |
| 功能描述 | 领地信息查看与管理 |
| 核心文件 | TerritoryManager.swift |

**功能要求**:
- [ ] 领地命名
- [ ] 面积显示
- [ ] 建筑数量统计
- [ ] 允许交易开关
- [ ] 领地活跃度管理（30天内需开始建设，90天内需保持活跃）

**技术方案**: Supabase Database + PostGIS

---

### 4.2 第二部分：探索与资源获取

#### P0-004 POI发现与搜刮
| 属性 | 说明 |
|------|------|
| 优先级 | P0（核心功能） |
| 功能描述 | 玩家走近真实地标自动发现并可搜刮资源 |
| 核心文件 | POIManager.swift, ExplorationManager.swift |

**功能要求**:
- [ ] 自动识别附近POI（医院、超市、工厂、公园、银行等）
- [ ] 地理围栏触发（进入POI范围触发发现）
- [ ] 资源类型映射
- [ ] 搜刮动作与结果展示
- [ ] 探索成就记录（距离、时长）

**POI-资源映射表**:
| POI类型 | 产出资源 |
|---------|---------|
| 医院/药店 | 药品（急救包、抗生素） |
| 超市/餐厅 | 食物（罐头、饮用水） |
| 工厂/工地 | 金属材料 |
| 公园/林地 | 木材 |
| 银行/珠宝店 | 稀有材料 |

**技术方案**: 苹果MapKit POI数据 + 地理围栏

---

#### P0-005 背包系统
| 属性 | 说明 |
|------|------|
| 优先级 | P0（核心功能） |
| 功能描述 | 玩家物品管理与存储 |
| 核心文件 | ItemManager.swift |

**功能要求**:
- [ ] 物品列表展示
- [ ] 容量限制（默认100格）
- [ ] 物品分类筛选
- [ ] 物品使用
- [ ] 本地优先架构（离线可用）

**技术方案**: 本地存储 + 云端异步同步

---

### 4.3 第三部分：建造与交易系统

#### P0-006 建造系统
| 属性 | 说明 |
|------|------|
| 优先级 | P0（核心功能） |
| 功能描述 | 在领地上消耗资源建造建筑 |
| 核心文件 | BuildingManager.swift |

**功能要求**:
- [ ] 建筑分类浏览（生存、储存、生产、能源）
- [ ] 资源需求检查
- [ ] 建筑放置位置选择
- [ ] 建造进度
- [ ] 资源不足提示

**建筑等级体系**: Tier 1（生存基础） → Tier 2（功能扩展） → Tier 3（高级设施）

**建筑列表（15种）**:
| 分类 | 建筑 |
|------|------|
| 生存类 | 篝火、庇护所 |
| 储存类 | 小仓库、中仓库 |
| 生产类 | 农田、工作台 |
| 能源类 | 太阳能板、风力发电机 |

---

#### P0-007 建筑状态管理
| 属性 | 说明 |
|------|------|
| 优先级 | P1 |
| 功能描述 | 建筑状态流转与管理 |

**状态机设计**:
- 建造中 → 待激活 → 运行中 ↔ 损坏
- 只有"运行中"状态可升级

**功能要求**:
- [ ] 状态显示
- [ ] 激活操作
- [ ] 升级操作（需激活状态）
- [ ] 维修操作

---

#### P0-008 交易系统
| 属性 | 说明 |
|------|------|
| 优先级 | P0（核心功能） |
| 功能描述 | 玩家间物物交换 |
| 核心文件 | TradeManager.swift |

**功能要求**:
- [ ] 发布挂单（"我提供" + "我需要"）
- [ ] 浏览附近挂单（100米内可见）
- [ ] 接受交易
- [ ] 交易历史记录

**交易规则**:
- 基于位置：需进入对方领地100米范围才能看到挂单
- 以物易物：无货币系统

---

### 4.4 第四部分：通讯系统

#### P1-009 消息中心
| 属性 | 说明 |
|------|------|
| 优先级 | P1 |
| 功能描述 | 系统消息推送与查看 |
| 核心文件 | RadioManager.swift |

**功能要求**:
- [ ] 官方消息分类展示
- [ ] 生存指南推送
- [ ] 每日任务通知
- [ ] 官方公告

---

#### P1-010 公共频道聊天
| 属性 | 说明 |
|------|------|
| 优先级 | P1 |
| 功能描述 | 基于位置的公共聊天室 |
| 核心文件 | CommunicationManager.swift |

**功能要求**:
- [ ] 覆盖范围限制（3km）
- [ ] 实时消息收发
- [ ] 消息秒级送达

**技术方案**: Supabase Realtime

---

#### P1-011 频道管理
| 属性 | 说明 |
|------|------|
| 优先级 | P1 |
| 功能描述 | 玩家创建和加入主题频道 |
| 核心文件 | ChannelManager.swift |

**功能要求**:
- [ ] 频道列表浏览（名称、距离、在线人数）
- [ ] 创建频道
- [ ] 加入/退出频道
- [ ] 频道内聊天

---

#### P2-012 PTT呼叫
| 属性 | 说明 |
|------|------|
| 优先级 | P2 |
| 功能描述 | 模拟对讲机的语音呼叫功能 |

**功能要求**:
- [ ] 长按发送语音消息
- [ ] 频率显示
- [ ] 公共频道广播

---

#### P2-013 通讯设备等级
| 属性 | 说明 |
|------|------|
| 优先级 | P2 |
| 功能描述 | 通讯设备升级系统 |

**设备等级**:
| 设备 | 功能 | 范围 |
|------|------|------|
| 收音机 | 只收不发 | - |
| 对讲机 | 收发 | 3km |
| 营地电台 | 收发 | 10km |
| 卫星通讯 | 收发 | 全球 |

---

### 4.5 第五部分：个人中心与商业化

#### P0-014 个人主页
| 属性 | 说明 |
|------|------|
| 优先级 | P0 |
| 功能描述 | 玩家档案展示 |

**功能要求**:
- [ ] 幸存者等级显示
- [ ] 存活天数统计
- [ ] 领地数量与总面积
- [ ] 建筑数量

---

#### P1-015 多语言设置
| 属性 | 说明 |
|------|------|
| 优先级 | P1 |
| 功能描述 | 应用语言切换 |

**支持语言**:
- 简体中文
- 繁体中文
- English

---

#### P0-016 付费订阅系统
| 属性 | 说明 |
|------|------|
| 优先级 | P0（商业核心） |
| 功能描述 | 内购与订阅系统 |
| 核心文件 | StoreKitManager.swift |

**订阅方案**:
| 方案 | 价格 | 权益 |
|------|------|------|
| 开拓者月卡 | $9.99/月 | 无限探索、范围扩大 |
| 领主通行证 | $19.99/月 | 所有特权 |

**一次性购买**:
| 商品 | 价格 |
|------|------|
| 初级物资包 | $0.99 |
| 中级物资包 | $2.99 |
| 稀有资源包 | $9.99 |

**技术方案**: StoreKit 2

---

#### P1-017 排行榜
| 属性 | 说明 |
|------|------|
| 优先级 | P1 |
| 功能描述 | 玩家排名系统 |
| 核心文件 | LeaderboardManager.swift |

**榜单类型**:
- 领地面积榜
- 探索废墟榜
- 建筑数量榜

**技术优化**: 数据库窗口函数 + 5分钟缓存

---

#### P1-018 成就系统
| 属性 | 说明 |
|------|------|
| 优先级 | P1 |
| 功能描述 | 游戏成就与奖励 |
| 核心文件 | AchievementManager.swift |

**成就稀有度**: 普通 → 稀有 → 史诗 → 传说

**成就分类**:
- 新手成就（引导熟悉游戏）
- 进阶成就（挑战更高目标）
- 稀有成就（少数玩家达成）

**技术方案**: EventBus发布-订阅模式

---

#### P1-019 生存体征
| 属性 | 说明 |
|------|------|
| 优先级 | P1 |
| 功能描述 | 角色生存状态管理 |
| 核心文件 | VitalSignsManagerV2.swift |

**体征指标**:
| 指标 | 说明 | 衰减速率 |
|------|------|---------|
| 核心生命 | 降到0则死亡 | - |
| 饱食度 | 太低掉血 | -5/小时 |
| 水分 | 太低掉血 | -10/小时 |

**增益机制**: 饱食度/水分 > 80% 时获得额外增益

---

## 五、非功能需求

### 5.1 性能需求
- GPS定位精度：5米以内
- 消息送达延迟：< 1秒
- 排行榜查询响应：< 500ms（支持10万+用户）
- 离线可用：背包、领地等核心数据本地缓存

### 5.2 安全需求
- OAuth 2.0认证
- 数据传输HTTPS加密
- GPS防作弊检测

### 5.3 可用性需求
- 支持离线模式（核心数据本地存储）
- 弱网环境下优雅降级

### 5.4 兼容性需求
- iOS 15.0+
- iPhone 8及以上设备

---

## 六、技术架构

### 6.1 客户端
- **开发语言**: Swift
- **UI框架**: SwiftUI
- **地图服务**: Apple MapKit
- **定位服务**: CoreLocation
- **支付服务**: StoreKit 2

### 6.2 后端服务
- **BaaS平台**: Supabase
  - 用户认证: Supabase Auth
  - 数据库: PostgreSQL + PostGIS
  - 实时推送: Supabase Realtime
  - 文件存储: Supabase Storage

### 6.3 核心代码文件
| 模块 | 文件 |
|------|------|
| 登录认证 | AuthManager.swift |
| GPS定位 | LocationManager.swift |
| 领地管理 | TerritoryManager.swift |
| POI发现 | POIManager.swift |
| 探索系统 | ExplorationManager.swift |
| 物品管理 | ItemManager.swift |
| 建筑系统 | BuildingManager.swift |
| 交易系统 | TradeManager.swift |
| 通讯系统 | RadioManager.swift, CommunicationManager.swift, ChannelManager.swift |
| 支付系统 | StoreKitManager.swift |
| 排行榜 | LeaderboardManager.swift |
| 成就系统 | AchievementManager.swift |
| 生存体征 | VitalSignsManagerV2.swift |

---

## 七、商业模式

### 7.1 收入来源
1. **订阅收入**: 月卡、通行证
2. **一次性购买**: 资源包
3. **未来扩展**: 皮肤、装饰品

### 7.2 用户增长策略
- 排行榜激发竞争
- 成就系统提高留存
- 社交系统促进传播

---

## 八、版本规划

### v1.0 MVP
- 登录注册
- GPS圈地
- POI探索
- 背包系统
- 基础建造
- 付费系统

### v1.1
- 交易系统
- 公共聊天
- 排行榜
- 成就系统

### v1.2
- 频道系统
- PTT呼叫
- 设备升级
- 生存体征

### v2.0
- 联盟系统
- 领地战争
- 更多建筑类型

---

## 九、成功指标

| 指标 | 目标值 |
|------|--------|
| 日活用户(DAU) | 10,000+ |
| 次日留存率 | > 40% |
| 7日留存率 | > 20% |
| 付费转化率 | > 5% |
| ARPU | > $2 |

---

**文档结束**
