# 地球新主 - 游戏设计文档 (GDD)

**文档版本**: v1.0
**创建日期**: 2025-12-23
**游戏名称**: 地球新主 (New Earth Master)
**游戏类型**: LBS末日生存手游
**游戏引擎**: SwiftUI + MapKit (原生iOS开发)

---

## 一、游戏概述

### 1.1 核心理念
**"用脚步丈量你的王国"** —— 在末日废土上，玩家通过真实世界的行走来圈占虚拟领地、探索废墟、收集资源、建设家园，最终重建文明。

### 1.2 游戏类型
- **主类型**: LBS（位置服务）游戏
- **子类型**: 生存建造 + 社交交易
- **对标产品**: 宝可梦GO × 饥荒 × 部落冲突

### 1.3 核心体验
| 体验要素 | 描述 |
|---------|------|
| **探索感** | 走出家门，发现真实世界中隐藏的"宝藏" |
| **成就感** | 用双脚丈量的领地，亲手建造的家园 |
| **紧迫感** | 生存体征衰减，必须持续活动 |
| **社交感** | 与附近玩家交易、聊天、协作 |

### 1.4 一句话描述
> 末日之后，用双脚圈占废土，用智慧重建文明。

---

## 二、世界观设定

### 2.1 背景故事

#### 时间线
```
2048年 - "终末战争"爆发
         全球文明在72小时内崩塌
         99%的人口消失
         所有土地所有权作废

2051年 - 幸存者从废墟中走出
         《新开拓者协议》颁布
         新秩序开始建立
```

#### 核心设定
**《新开拓者协议》**的核心条款：
> "凡以双足丈量之无主土地，皆为开拓者所有。"

这意味着：
- 旧世界的一切土地所有权失效
- 新的土地归属以"步行丈量"为准
- 必须亲自走完领地边界才能占有
- GPS卫星系统被重新启用，记录所有圈地行为

### 2.2 艺术风格：希望朋克 (Hopepunk)

#### 视觉定义
不同于传统末日题材的黑暗绝望，"希望朋克"强调废土之上的新生：

| 元素 | 传统末日 | 希望朋克 |
|------|---------|---------|
| 色调 | 灰暗、棕色 | 灰绿色、带有生机的暖色 |
| 植物 | 枯萎、死亡 | 破土而出、顽强生长 |
| 建筑 | 废墟、残骸 | 废墟上的新建筑 |
| 情绪 | 绝望、恐惧 | 希望、重建 |

#### 关键视觉元素
- 卫星地图风格的游戏地图
- 末日滤镜下的真实世界
- 废墟中生长的绿色植物
- 破败建筑上闪烁的新生标志

### 2.3 游戏世界

#### 地图表现
- 使用苹果MapKit卫星图作为基础
- 叠加末日风格滤镜
- 玩家领地显示为绿色多边形
- POI点显示为可交互图标

#### 真实与虚拟的融合
| 真实世界 | 游戏世界 |
|---------|---------|
| 医院 | 医疗物资点 |
| 超市 | 食物补给站 |
| 工厂 | 金属材料库 |
| 公园 | 木材采集地 |
| 银行 | 稀有资源库 |

---

## 三、核心玩法设计

### 3.1 游戏循环

#### 主循环
```
┌─────────────────────────────────────────────────────────────┐
│                      核心游戏循环                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   【身份建立】登录注册                                        │
│        ↓                                                    │
│   【领地获取】GPS圈地 ──────→ 拥有土地                        │
│        ↓                                                    │
│   【资源获取】探索POI ──────→ 搜刮物资                        │
│        ↓                                                    │
│   【资源消耗】                                               │
│        ├── 建造建筑 ──────→ 扩展功能                         │
│        ├── 交易换物 ──────→ 社交互动                         │
│        └── 生存消耗 ──────→ 维持生存                         │
│        ↓                                                    │
│   【成长反馈】成就解锁 + 排行提升                              │
│        ↓                                                    │
│   【循环激励】更大领地 + 更多资源 + 更高地位                    │
│        ↓                                                    │
│   ←───────────────────────────────────────────────────────  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 日循环
1. **登录** → 查看生存状态
2. **规划** → 决定今天探索方向
3. **外出** → 圈地/探索
4. **收获** → 整理背包
5. **建设** → 消耗资源建造
6. **社交** → 与玩家交易聊天
7. **回顾** → 查看成就排名

### 3.2 圈地系统

#### 玩法概述
玩家在现实中行走，GPS轨迹在游戏地图上绘制成多边形，闭合后成为玩家领地。

#### 操作流程
```
1. 点击"开始开拓"按钮
2. 开始在现实中行走
3. 蓝色轨迹线实时绘制
4. 走回起点50米范围内
5. 系统自动闭合多边形
6. 验证通过 → 领地归属玩家
```

#### 验证规则
| 规则 | 说明 |
|------|------|
| 闭合要求 | 终点距起点50米以内 |
| 形状要求 | 不能自交叉 |
| 重叠检测 | 不能与他人领地重叠 |
| 最小面积 | 建议 > 500m² |
| 最大面积 | 单次 < 100,000m² |

#### 反作弊机制
- GPS漂移检测
- 移动速度异常检测
- 信号强度验证
- 历史轨迹分析

### 3.3 探索系统

#### POI发现机制
玩家走近真实世界的地标点(POI)，游戏自动识别并触发"发现"事件。

#### 触发条件
- 进入POI中心点100米范围内
- 同一POI每日可搜刮次数有限

#### 资源产出表

| POI类型 | 主要产出 | 稀有产出 | 搜刮冷却 |
|---------|---------|---------|---------|
| 医院/药店 | 药品×5-15 | 急救包×1-2 | 4小时 |
| 超市/餐厅 | 食物×10-30 | 罐头×5-10 | 2小时 |
| 工厂/工地 | 金属×5-20 | 电子元件×1-3 | 6小时 |
| 公园/林地 | 木材×10-25 | 种子×2-5 | 3小时 |
| 银行/珠宝店 | 稀有材料×1-5 | 卫星模块×0-1 | 12小时 |

#### 探索成就记录
- 累计探索距离
- 单次探索时长
- 发现POI数量
- 稀有物资获取

### 3.4 资源系统

#### 资源分类

**基础资源**
| 资源 | 用途 | 来源 |
|------|------|------|
| 木材 | 基础建造 | 公园、林地 |
| 石头 | 基础建造 | 工地、山区 |
| 金属 | 高级建造 | 工厂、工地 |
| 食物 | 恢复饱食度 | 超市、餐厅 |
| 水 | 恢复水分 | 便利店、餐厅 |
| 药品 | 恢复生命 | 医院、药店 |

**高级资源**
| 资源 | 用途 | 来源 |
|------|------|------|
| 布料 | 装备制作 | 商场 |
| 电子元件 | 设备升级 | 电子城 |
| 卫星模块 | 通讯升级 | 银行、特殊建筑 |

#### 背包系统

**基础参数**
- 初始容量：100格
- 堆叠上限：99个/格
- 扩容方式：建造仓库

**本地优先架构**
```
用户操作 → 本地数据库更新 → UI即时响应
                ↓
         异步同步到云端
                ↓
         网络恢复时自动同步
```

### 3.5 建造系统

#### 建筑等级体系
```
Tier 1 (生存基础)
    └── 基础生存建筑，低资源消耗

Tier 2 (功能扩展)
    └── 功能性建筑，中等资源消耗

Tier 3 (高级设施)
    └── 高级建筑，高资源消耗
```

#### 建筑详细设计

**Tier 1 - 生存类**
| 建筑 | 资源需求 | 功能 |
|------|---------|------|
| 篝火 | 石头×20, 木材×30 | 取暖，减缓体征衰减 |
| 简易庇护所 | 木材×50, 布料×20 | 休息，恢复体征 |

**Tier 1 - 储存类**
| 建筑 | 资源需求 | 功能 |
|------|---------|------|
| 小仓库 | 木材×40, 金属×10 | +50背包容量 |
| 储水罐 | 金属×30 | 存储水资源 |

**Tier 2 - 生产类**
| 建筑 | 资源需求 | 功能 |
|------|---------|------|
| 农田 | 木材×30, 种子×10 | 定时产出食物 |
| 工作台 | 木材×40, 金属×20 | 制作高级物品 |

**Tier 2 - 能源类**
| 建筑 | 资源需求 | 功能 |
|------|---------|------|
| 太阳能板 | 金属×50, 电子元件×5 | 提供电力 |
| 风力发电机 | 金属×80, 电子元件×10 | 提供更多电力 |

#### 建筑状态机

```
                    ┌──────────┐
                    │  建造中   │
                    └────┬─────┘
                         ↓ (建造完成)
                    ┌──────────┐
                    │  待激活   │
                    └────┬─────┘
                         ↓ (激活操作)
         ┌───────────────┴───────────────┐
         ↓                               ↓
    ┌──────────┐                   ┌──────────┐
    │  运行中   │ ←───(维修)───── │   损坏    │
    └────┬─────┘                   └──────────┘
         ↓ (损坏触发)                    ↑
         └───────────────────────────────┘
```

**状态说明**
| 状态 | 可执行操作 |
|------|-----------|
| 建造中 | 取消 |
| 待激活 | 激活、拆除 |
| 运行中 | 使用、升级、拆除 |
| 损坏 | 维修、拆除 |

### 3.6 生存体征系统

#### 核心指标

| 指标 | 初始值 | 最大值 | 衰减速率 | 降至0后果 |
|------|--------|--------|---------|----------|
| 核心生命 | 100 | 100 | 视饱食/水分 | 角色死亡 |
| 饱食度 | 100% | 100% | -5%/小时 | 每分钟-1生命 |
| 水分 | 100% | 100% | -10%/小时 | 每分钟-2生命 |

#### 增益/减益机制

| 状态条件 | 效果 |
|---------|------|
| 饱食度 > 80% AND 水分 > 80% | 探索效率+20% |
| 饱食度 < 30% OR 水分 < 30% | 移动速度-20% |
| 饱食度 = 0% OR 水分 = 0% | 持续掉血 |

#### 恢复方式
| 物品 | 恢复效果 |
|------|---------|
| 罐头食品 | 饱食度+20% |
| 面包 | 饱食度+10% |
| 饮用水 | 水分+30% |
| 急救包 | 生命+30 |
| 药品 | 生命+10 |

### 3.7 交易系统

#### 玩法概述
玩家间以物易物，无货币系统。

#### 交易流程
```
发布方                              接受方
   │                                  │
   │ 1.创建挂单                        │
   │ (我提供X, 我需要Y)                 │
   │                                  │
   │         2.进入100米范围            │
   │ ←─────────────────────────────── │
   │                                  │
   │         3.发现挂单                │
   │ ─────────────────────────────→   │
   │                                  │
   │         4.接受交易                │
   │ ←─────────────────────────────── │
   │                                  │
   │ 5.资源自动转移                     │
   │                                  │
   ↓                                  ↓
完成交易                            完成交易
```

#### 交易规则
- **位置限制**: 必须进入对方领地100米范围
- **挂单可见**: 只有开启"允许交易"的领地挂单可见
- **无手续费**: 纯物物交换，无额外消耗
- **即时完成**: 接受交易后立即生效

---

## 四、通讯系统设计

### 4.1 通讯设备等级

```
Level 1: 收音机 (初始设备)
    └── 仅接收，不能发送

Level 2: 对讲机
    └── 收发，范围3km
    └── 解锁条件：资源制作

Level 3: 营地电台
    └── 收发，范围10km
    └── 解锁条件：建造电台建筑

Level 4: 卫星通讯
    └── 收发，全球范围
    └── 解锁条件：收集卫星模块
```

### 4.2 消息类型

#### 系统消息
- 官方公告
- 生存指南
- 每日任务
- 活动通知

#### 玩家消息
- 公共频道（基于位置的广播）
- 私有频道（加入后可见）
- PTT语音（对讲机模式）

### 4.3 频道系统

#### 公共频道
- 覆盖范围：3km（取决于设备等级）
- 所有人可见
- 实时消息

#### 私有频道
- 需创建或加入
- 频道内成员可见
- 支持命名、描述

### 4.4 PTT (Push to Talk)

#### 操作设计
- 长按麦克风按钮
- 录制语音消息
- 松开发送

#### 沉浸感设计
- 模拟无线电频率显示（如438.000）
- 发送时的静电音效
- 接收时的提示音

---

## 五、成长与激励系统

### 5.1 成就系统

#### 成就分类

**新手成就**（引导玩家熟悉游戏）
| 成就 | 条件 | 奖励 |
|------|------|------|
| 初入废土 | 完成注册 | 金币×100 |
| 新手领主 | 完成第一次圈地 | 金币×200 |
| 末世拾荒者 | 完成第一次搜刮 | 金币×150 |
| 火种守护者 | 建造第一个篝火 | 金币×200 |

**进阶成就**（持续激励）
| 成就 | 条件 | 奖励 |
|------|------|------|
| 地主 | 拥有5块领地 | 金币×500 |
| 行者 | 探索累计100km | 金币×800 |
| 建筑师 | 建造20个建筑 | 金币×600 |
| 商人 | 完成50次交易 | 金币×1000 |

**稀有成就**（炫耀与荣誉）
| 成就 | 条件 | 奖励 |
|------|------|------|
| 万顷领主 | 领地总面积超10万m² | 金币×2000 + 称号 |
| 千里行者 | 探索累计1000km | 金币×3000 + 称号 |
| 废土传奇 | 存活365天 | 金币×5000 + 专属头像框 |

#### 稀有度设计
```
普通 (Common) ───→ 稀有 (Rare) ───→ 史诗 (Epic) ───→ 传说 (Legendary)
    灰色边框           蓝色边框         紫色边框          金色边框
```

#### 技术实现：EventBus
```
游戏事件发生
    ↓
发布事件 (如: "圈地完成")
    ↓
成就系统订阅 → 检查是否达成 → 解锁成就
排行榜系统订阅 → 更新数据
统计系统订阅 → 记录日志
```

### 5.2 排行榜系统

#### 榜单类型
| 榜单 | 排序依据 | 刷新频率 |
|------|---------|---------|
| 领地面积榜 | 总领地面积 | 5分钟 |
| 探索废墟榜 | 累计探索距离 | 5分钟 |
| 建筑数量榜 | 建筑总数 | 5分钟 |

#### 排名展示
- Top 100 完整显示
- 显示"我的排名"
- 显示与上一名的差距

### 5.3 玩家档案

#### 展示内容
- 幸存者等级
- 存活天数
- 领地数量 & 总面积
- 建筑数量
- 成就完成度
- 获得的称号

---

## 六、商业化设计

### 6.1 付费策略

#### 原则
- **免费可玩**：所有核心玩法免费
- **付费加速**：花钱可以更快发展
- **不卖数值**：不出售破坏平衡的强力道具

### 6.2 订阅产品

#### 开拓者月卡 - $9.99/月
| 权益 | 说明 |
|------|------|
| 无限探索 | 移除每日探索次数限制 |
| 范围扩大 | POI发现范围+50% |
| 专属标识 | 名字旁显示月卡图标 |
| 每日资源 | 每日登录送基础资源包 |

#### 领主通行证 - $19.99/月
| 权益 | 说明 |
|------|------|
| 包含月卡所有权益 | - |
| 双倍资源 | 搜刮资源×2 |
| 额外仓库 | +200背包容量 |
| 优先客服 | 专属客服通道 |
| 专属皮肤 | 领地边框特效 |

### 6.3 一次性购买

#### 资源包
| 商品 | 价格 | 内容 |
|------|------|------|
| 初级物资包 | $0.99 | 食物×50, 水×50, 木材×30 |
| 中级物资包 | $2.99 | 食物×150, 水×150, 木材×100, 金属×50 |
| 高级物资包 | $9.99 | 大量各类资源 + 稀有材料×5 |
| 稀有资源包 | $19.99 | 卫星模块×3 + 电子元件×20 |

#### 功能解锁
| 商品 | 价格 | 效果 |
|------|------|------|
| 仓库扩容 | $4.99 | +100背包永久容量 |
| 设备升级包 | $9.99 | 快速解锁对讲机 |

### 6.4 付费点嵌入

| 场景 | 付费引导 |
|------|---------|
| 背包满了 | "升级仓库，容量翻倍" |
| 资源不足 | "购买资源包，立即建造" |
| 通讯受限 | "升级设备，扩大范围" |
| 体征过低 | "购买急救包，快速恢复" |

---

## 七、数值平衡

### 7.1 时间经济

#### 典型游戏session
| 活动 | 建议时长 | 收益 |
|------|---------|------|
| 日常探索 | 15-30分钟 | 基础资源满足生存 |
| 深度探索 | 1-2小时 | 大量资源+稀有物品 |
| 圈地活动 | 30-60分钟 | 新领地获取 |

#### 资源获取/消耗平衡
- 日均探索30分钟 = 满足生存消耗 + 少量盈余
- 建造1个Tier1建筑 ≈ 2-3次深度探索的资源

### 7.2 生存压力曲线

```
饱食度/水分衰减曲线:

100% │────┐
     │    └────┐
 80% │         └────┐    ← 增益区间
     │              └────┐
 50% │                   └────┐
     │                        └────┐
 30% │                             └─ ← 减益开始
     │                                └──
  0% │                                   └──→ 持续掉血
     └─────────────────────────────────────────→ 时间
     0h    2h    4h    6h    8h    10h   12h
```

### 7.3 建筑解锁节奏

| 游戏天数 | 建议达成 |
|---------|---------|
| Day 1 | 完成注册，第一块领地 |
| Day 3 | 篝火，简易庇护所 |
| Day 7 | 小仓库，农田 |
| Day 14 | 对讲机，工作台 |
| Day 30 | 营地电台，多块领地 |

---

## 八、UI/UX设计

### 8.1 主界面布局

```
┌─────────────────────────────────────────┐
│  [状态栏] 生命/饱食度/水分              │
├─────────────────────────────────────────┤
│                                         │
│                                         │
│           [卫星地图]                     │
│          玩家位置标识                    │
│          领地多边形显示                  │
│          POI图标                         │
│                                         │
│                                         │
├─────────────────────────────────────────┤
│  [快捷操作区]                           │
│  [开始开拓] [背包] [建造]               │
├─────────────────────────────────────────┤
│  [底部导航]                             │
│  地图 | 领地 | 通讯 | 个人              │
└─────────────────────────────────────────┘
```

### 8.2 核心交互

#### 圈地交互
1. 点击"开始开拓"→ 地图进入绘制模式
2. 行走时实时显示蓝色轨迹
3. 接近起点时，闭合提示出现
4. 点击"完成圈地"→ 验证动画
5. 成功/失败反馈

#### 搜刮交互
1. 走近POI → 发现气泡弹出
2. 点击气泡 → 进入搜刮界面
3. 点击"搜刮" → 搜刮动画
4. 展示获得物品列表
5. 物品自动进入背包

### 8.3 视觉反馈

| 操作 | 反馈 |
|------|------|
| 发现POI | 屏幕边缘发光提示 + 声音 |
| 圈地闭合 | 绿色波纹扩散动画 |
| 资源不足 | 红色闪烁 + 震动 |
| 成就解锁 | 全屏展示 + 金色粒子 |
| 生存警告 | 屏幕边缘红色渐变 |

---

## 九、技术实现要点

### 9.1 核心Manager类

| 模块 | 文件 | 职责 |
|------|------|------|
| 认证 | AuthManager.swift | 用户登录、注册、会话管理 |
| 定位 | LocationManager.swift | GPS定位、轨迹记录 |
| 领地 | TerritoryManager.swift | 领地数据、验证、存储 |
| POI | POIManager.swift | POI发现、地理围栏 |
| 探索 | ExplorationManager.swift | 搜刮逻辑、资源发放 |
| 物品 | ItemManager.swift | 背包管理、物品操作 |
| 建造 | BuildingManager.swift | 建筑逻辑、资源消耗 |
| 交易 | TradeManager.swift | 挂单、交易匹配 |
| 通讯 | CommunicationManager.swift | 实时消息 |
| 频道 | ChannelManager.swift | 频道管理 |
| 支付 | StoreKitManager.swift | 内购处理 |
| 排行 | LeaderboardManager.swift | 排名计算 |
| 成就 | AchievementManager.swift | 成就检测 |
| 体征 | VitalSignsManagerV2.swift | 生存指标 |

### 9.2 关键技术选型

| 需求 | 技术方案 | 理由 |
|------|---------|------|
| 地图 | Apple MapKit | 免费、全球可用 |
| 定位 | CoreLocation | 原生、省电 |
| 数据库 | Supabase + PostGIS | 免费、支持地理查询 |
| 实时消息 | Supabase Realtime | 免费、开箱即用 |
| 支付 | StoreKit 2 | 最新API、更简单 |
| 本地存储 | SwiftData | 原生、离线支持 |

### 9.3 架构模式

#### 本地优先 (Local-First)
```
用户操作
    ↓
本地数据库写入 → UI立即更新
    ↓
后台队列 → 网络可用时同步
    ↓
云端数据库
```

#### 事件总线 (EventBus)
```
游戏事件 → EventBus
               ↓
    ┌──────────┼──────────┐
    ↓          ↓          ↓
成就系统   排行榜系统   统计系统
```

---

## 十、附录

### 10.1 术语表

| 术语 | 定义 |
|------|------|
| POI | Point of Interest，兴趣点，真实世界的地标 |
| LBS | Location-Based Service，基于位置的服务 |
| 圈地 | 玩家通过行走绘制多边形领地的行为 |
| 搜刮 | 在POI点获取资源的行为 |
| 挂单 | 玩家发布的交易请求 |
| 体征 | 角色的生存状态指标 |

### 10.2 代码文件索引

**第一部分：登录与圈地**
- AuthManager.swift
- LocationManager.swift
- TerritoryManager.swift

**第二部分：探索与资源**
- POIManager.swift
- ExplorationManager.swift
- ItemManager.swift

**第三部分：建造与交易**
- BuildingManager.swift
- TradeManager.swift

**第四部分：通讯系统**
- RadioManager.swift
- CommunicationManager.swift
- ChannelManager.swift

**第五部分：个人中心与商业化**
- StoreKitManager.swift
- LeaderboardManager.swift
- AchievementManager.swift
- VitalSignsManagerV2.swift

---

**文档结束**

*版本历史*
| 版本 | 日期 | 修改内容 |
|------|------|---------|
| v1.0 | 2025-12-23 | 初始版本 |
